<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>倒计时管理</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
			background-color: #f4f4f4;
			color: #333;
		}

		.container {
			max-width: 800px;
			margin: 0 auto;
			background: #fff;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}

		.form-group {
			margin-bottom: 15px;
		}

		.form-group label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
		}

		.form-group input,
		.form-group button {
			width: 100%;
			padding: 10px;
			box-sizing: border-box;
			border: 1px solid #ccc;
			border-radius: 4px;
		}

		.form-group button {
			background-color: #007BFF;
			color: #fff;
			border: none;
			cursor: pointer;
		}

		.form-group button:hover {
			background-color: #0056b3;
		}

		.timer-list {
			margin-top: 20px;
		}

		.timer-item {
			background: #f9f9f9;
			padding: 20px;
			/* 增加内边距 */
			margin-bottom: 15px;
			/* 增加外边距 */
			border-radius: 8px;
			/* 保持圆角 */
			border: 1px solid #ddd;
			/* 保持边框 */
			display: flex;
			justify-content: space-between;
			align-items: center;
			font-size: 16px;
			/* 增加字体大小 */
		}

		.timer-item h3 {
			margin: 0 0 10px;
		}

		.timer-item p {
			margin: 0 0 10px;
		}

		.timer-item .time-box {
			display: flex;
			gap: 10px;
		}

		.timer-item .time-box span {
			background: #ffcc00;
			/* 更鲜艳的黄色 */
			color: #333;
			/* 深色文字 */
			padding: 5px 10px;
			border-radius: 4px;
			font-weight: bold;
		}

		.timer-item button {
			background-color: #dc3545;
			color: #fff;
			border: none;
			padding: 5px 10px;
			border-radius: 4px;
			cursor: pointer;
		}

		.timer-item button:hover {
			background-color: #a71d2a;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0, 0, 0, 0.4);
		}

		.modal-content {
			background-color: #fefefe;
			margin: 15% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
			border-radius: 8px;
		}

		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>倒计时管理</h1>
		<div class="form-group">
			<label for="title">标题</label>
			<input type="text" id="title" placeholder="标题">
		</div>
		<div class="form-group">
			<label for="start-time">开始时间 (格式: HH:MM:SS)</label>
			<input type="text" id="start-time" placeholder="开始时间">
		</div>
		<div class="form-group">
			<label for="end-time">结束时间 (格式: HH:MM:SS)</label>
			<input type="text" id="end-time" placeholder="结束时间">
		</div>
		<button id="add-timer">添加倒计时</button>
		<button id="manage-timers">管理倒计时</button>
		<div id="timer-list" class="timer-list"></div>
	</div>

	<!-- 编辑模态框 -->
	<div id="edit-modal" class="modal">
		<div class="modal-content">
			<span class="close">&times;</span>
			<h2>编辑倒计时</h2>
			<div class="form-group">
				<label for="edit-title">标题</label>
				<input type="text" id="edit-title" placeholder="标题">
			</div>
			<div class="form-group">
				<label for="edit-start-time">开始时间 (格式: HH:MM:SS)</label>
				<input type="text" id="edit-start-time" placeholder="开始时间">
			</div>
			<div class="form-group">
				<label for="edit-end-time">结束时间 (格式: HH:MM:SS)</label>
				<input type="text" id="edit-end-time" placeholder="结束时间">
			</div>
			<button id="save-edit">保存更改</button>
		</div>
	</div>

	<script>
		const timerListElement = document.getElementById('timer-list');
		const titleInput = document.getElementById('title');
		const startTimeInput = document.getElementById('start-time');
		const endTimeInput = document.getElementById('end-time');
		const editModal = document.getElementById('edit-modal');
		const closeModal = document.getElementsByClassName('close')[0];
		const editTitleInput = document.getElementById('edit-title');
		const editStartTimeInput = document.getElementById('edit-start-time');
		const editEndTimeInput = document.getElementById('edit-end-time');
		const saveEditButton = document.getElementById('save-edit');
		const manageTimersButton = document.getElementById('manage-timers');
		let isManaging = false;

		// 从localStorage加载倒计时列表
		let timers = JSON.parse(localStorage.getItem('timers')) || [];

		function saveTimers() {
			localStorage.setItem('timers', JSON.stringify(timers));
		}

		// 保存倒计时到localStorage
		// 渲染倒计时列表
		function renderTimers() {
			timerListElement.innerHTML = '';
			const now = new Date();

			// 非管理模式下只显示当前时间范围内的倒计时，并进行排序
			if (!isManaging) {
				timers = timers.filter(timer => {
					const startTime = new Date();
					const endTime = new Date();
					startTime.setHours(timer.start.split(':')[0], timer.start.split(':')[1], timer.start.split(':')[2], 0);
					endTime.setHours(timer.end.split(':')[0], timer.end.split(':')[1], timer.end.split(':')[2], 0);
					return now >= startTime && now < endTime;
				});
			}

			// 按照结束时间排序，如果结束时间相同，则按照开始时间排序
			timers.sort((a, b) => {
				const endTimeA = new Date(a.end).getTime();
				const endTimeB = new Date(b.end).getTime();
				if (endTimeA !== endTimeB) {
					return endTimeA - endTimeB;
				}
				const startTimeA = new Date(a.start).getTime();
				const startTimeB = new Date(b.start).getTime();
				return startTimeA - startTimeB;
			});

			timers.forEach((timer, index) => {
				const startTime = new Date();
				const endTime = new Date();

				// 设置开始时间和结束时间为当天的特定时间
				startTime.setHours(timer.start.split(':')[0], timer.start.split(':')[1], timer.start.split(':')[2], 0);
				endTime.setHours(timer.end.split(':')[0], timer.end.split(':')[1], timer.end.split(':')[2], 0);

				if (isManaging) {
					// 管理模式下显示所有倒计时
					const timerItem = document.createElement('div');
					timerItem.className = 'timer-item';
					timerItem.innerHTML = `
                <div style="flex: 1;">
                    <h3 style="margin: 0 0 10px;">${timer.title}</h3>
                    <div class="time-box">
                        <span style="padding: 10px; font-size: 18px;">开始时间: ${timer.start}</span>
                        <span style="padding: 10px; font-size: 18px;">结束时间: ${timer.end}</span>
                    </div>
                </div>
                <div>
                    <button class="edit-btn" data-index="${index}">编辑</button>
                    <button class="delete-btn" data-index="${index}">删除</button>
                </div>
            `;
					timerListElement.appendChild(timerItem);
				} else if (now >= startTime && now < endTime) {
					// 非管理模式下只显示当前时间范围内的倒计时
					const timeLeft = endTime - now;
					const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
					const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

					const timerItem = document.createElement('div');
					timerItem.className = 'timer-item';
					timerItem.innerHTML = `
                <div style="flex: 1;">
                    <h3 style="margin: 0 0 10px;">${timer.title}</h3>
                    <div class="time-box">
                        <span style="padding: 10px; font-size: 18px;">${hours}时</span>
                        <span style="padding: 10px; font-size: 18px;">${minutes}分</span>
                        <span style="padding: 10px; font-size: 18px;">${seconds}秒</span>
                    </div>
                </div>
            `;
					timerListElement.appendChild(timerItem);
				}
			});
		}
		// 添加倒计时
		document.getElementById('add-timer').addEventListener('click', () => {
			const title = titleInput.value;
			const startTime = startTimeInput.value;
			const endTime = endTimeInput.value;

			if (title && startTime && endTime) {
				timers.push({ title, start: startTime, end: endTime });
				saveTimers();
				renderTimers();
				titleInput.value = '';
				startTimeInput.value = '';
				endTimeInput.value = '';
			} else {
				alert('请输入标题、开始时间和结束时间');
			}
		});
		// 管理倒计时
		manageTimersButton.addEventListener('click', () => {
			isManaging = !isManaging;
			manageTimersButton.textContent = isManaging ? '返回显示页面' : '管理倒计时';
			renderTimers();
		});

		// 编辑倒计时
		timerListElement.addEventListener('click', (e) => {
			if (e.target.classList.contains('edit-btn')) {
				const index = e.target.getAttribute('data-index');
				const timer = timers[index];

				editTitleInput.value = timer.title;
				editStartTimeInput.value = timer.start;
				editEndTimeInput.value = timer.end;

				editModal.style.display = 'block';
				saveEditButton.onclick = () => {
					const newTitle = editTitleInput.value;
					const newStartTime = editStartTimeInput.value;
					const newEndTime = editEndTimeInput.value;

					if (newTitle && newStartTime && newEndTime) {
						timers[index] = { title: newTitle, start: newStartTime, end: newEndTime };
						saveTimers();
						renderTimers();
						editModal.style.display = 'none';
					} else {
						alert('请输入标题、开始时间和结束时间');
					}
				};
			}
		});

		// 删除倒计时
		timerListElement.addEventListener('click', (e) => {
			if (e.target.classList.contains('delete-btn')) {
				const index = e.target.getAttribute('data-index');
				timers.splice(index, 1);
				saveTimers();
				renderTimers();
			}
		});

		// 关闭编辑模态框
		closeModal.onclick = () => {
			editModal.style.display = 'none';
		};

		// 初始化渲染
		renderTimers();

		// 每秒更新倒计时
		setInterval(renderTimers, 100);
	</script>
</body>

</html>
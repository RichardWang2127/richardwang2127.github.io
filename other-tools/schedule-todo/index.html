<!--æœ¬ä»£ç å…¨ç¯‡AIç”Ÿæˆï¼Œby ChatGPT-->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- é¡µé¢åˆ‡æ¢ -->
  <div class="flex justify-center space-x-4 p-4">
    <button onclick="switchPage('manage')" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">ç®¡ç†æ—¥ç¨‹</button>
    <button onclick="switchPage('view')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">æŸ¥çœ‹æ—¥ç¨‹</button>
  </div>

  <div id="managePage" class="max-w-4xl mx-auto p-4">
    <!-- æ·»åŠ å•ä¸ª -->
    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-xl font-semibold mb-2">â• æ·»åŠ å•ä¸ªä»»åŠ¡</h2>
      <input id="taskInput" placeholder="ä»»åŠ¡æ ‡é¢˜" class="w-full p-2 border rounded mb-2" />
      <button onclick="addTask()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">æ·»åŠ </button>
    </div>

    <!-- æ‰¹é‡æ·»åŠ  -->
    <div class="bg-white p-4 rounded shadow mt-6">
      <h2 class="text-xl font-semibold mb-2">ğŸ“¥ æ‰¹é‡æ·»åŠ ä»»åŠ¡ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</h2>
      <textarea id="bulkInput" rows="4" class="w-full p-2 border rounded mb-2" placeholder="ä»»åŠ¡1\nä»»åŠ¡2\nä»»åŠ¡3"></textarea>
      <button onclick="bulkAdd()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">æ‰¹é‡æ·»åŠ </button>
    </div>

    <!-- ç¼–è¾‘ä»»åŠ¡ -->
    <div class="bg-white p-4 rounded shadow mt-6">
      <h2 class="text-xl font-semibold mb-4">ğŸ›  ç¼–è¾‘ä»»åŠ¡è§¦å‘æ–¹å¼</h2>
      <div id="taskList" class="space-y-2"></div>
    </div>
  </div>

  <!-- æŸ¥çœ‹é¡µé¢ -->
  <div id="viewPage" class="max-w-3xl mx-auto p-4 hidden">
    <h2 class="text-2xl font-semibold mb-4">ğŸ“‹ æœªå®Œæˆä»»åŠ¡åˆ—è¡¨</h2>
    <div id="taskViewList" class="space-y-2 mb-8"></div>

    <h2 class="text-xl font-semibold mb-2">âœ… å·²å®Œæˆä»»åŠ¡æ¸…å•</h2>
    <div id="completedTaskList" class="space-y-2 text-gray-600"></div>
  </div>

  <script>
    let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");

    function save() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function switchPage(page) {
      document.getElementById("managePage").classList.toggle("hidden", page !== "manage");
      document.getElementById("viewPage").classList.toggle("hidden", page !== "view");
      if (page === "manage") renderManage();
      else renderView();
    }

    function addTask() {
      const title = document.getElementById("taskInput").value.trim();
      if (!title) return alert("è¯·è¾“å…¥ä»»åŠ¡åï¼");
      tasks.push({ id: Date.now(), title, triggerType: "none", triggerValue: "", completed: false });
      document.getElementById("taskInput").value = "";
      save(); renderManage();
    }

    function bulkAdd() {
      const lines = document.getElementById("bulkInput").value.trim().split("\n").map(x => x.trim()).filter(x => x);
      lines.forEach(title => {
        tasks.push({ id: Date.now() + Math.floor(Math.random() * 1000), title, triggerType: "none", triggerValue: "", completed: false });
      });
      document.getElementById("bulkInput").value = "";
      save(); renderManage();
    }

    function deleteTask(taskId) {
      tasks = tasks.filter(t => t.id !== taskId);
      save(); renderManage(); renderView();
    }

    function renderManage() {
      const container = document.getElementById("taskList");
      container.innerHTML = "";
      tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "p-2 border rounded bg-gray-50";

        const title = document.createElement("div");
        title.textContent = `${task.completed ? "âœ…" : "âŒ"} ${task.title}`;
        div.appendChild(title);

        const select = document.createElement("select");
        select.className = "border p-1 rounded mt-1";
        ["none", "time", "dependency"].forEach(t => {
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = { none: "æ— è§¦å‘", time: "å›ºå®šæ—¶é—´", dependency: "ä¾èµ–ä»»åŠ¡" }[t];
          if (task.triggerType === t) opt.selected = true;
          select.appendChild(opt);
        });
        select.onchange = () => {
          task.triggerType = select.value;
          task.triggerValue = "";
          save(); renderManage();
        };
        div.appendChild(select);

        if (task.triggerType === "time") {
          const input = document.createElement("input");
          input.type = "time";
          input.className = "ml-2 p-1 border rounded";
          input.value = task.triggerValue;
          input.onchange = () => {
            task.triggerValue = input.value;
            save();
          };
          div.appendChild(input);
        } else if (task.triggerType === "dependency") {
          const selectDep = document.createElement("select");
          selectDep.className = "ml-2 p-1 border rounded";
          tasks.forEach(t => {
            const opt = document.createElement("option");
            opt.value = t.id;
            opt.textContent = t.title;
            if (t.id == task.triggerValue) opt.selected = true;
            selectDep.appendChild(opt);
          });
          selectDep.onchange = () => {
            task.triggerValue = selectDep.value;
            save();
          };
          div.appendChild(selectDep);
        }

        const doneBtn = document.createElement("button");
        doneBtn.className = "ml-4 text-sm text-white bg-green-500 px-2 py-1 rounded hover:bg-green-600";
        doneBtn.textContent = task.completed ? "è®¾ä¸ºæœªå®Œæˆ" : "æ ‡è®°å®Œæˆ";
        doneBtn.onclick = () => {
          task.completed = !task.completed;
          save(); renderManage();
        };
        div.appendChild(doneBtn);

        const delBtn = document.createElement("button");
        delBtn.className = "ml-2 text-sm text-white bg-red-500 px-2 py-1 rounded hover:bg-red-600";
        delBtn.textContent = "ğŸ—‘ åˆ é™¤";
        delBtn.onclick = () => {
          if (confirm("ç¡®è®¤åˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ")) {
            deleteTask(task.id);
          }
        };
        div.appendChild(delBtn);

        container.appendChild(div);
      });
    }

    function renderView() {
      const container = document.getElementById("taskViewList");
      const completedContainer = document.getElementById("completedTaskList");
      container.innerHTML = "";
      completedContainer.innerHTML = "";

      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes();

      tasks.forEach(task => {
        if (!task.completed) {
          const div = document.createElement("div");
          div.className = "p-2 border rounded bg-white flex justify-between items-center";
          const leftSpan = document.createElement("span");
          leftSpan.textContent = task.title;
          div.appendChild(leftSpan);

          let canComplete = false;
          let info = "";

          if (task.triggerType === "none") {
            canComplete = true;
          } else if (task.triggerType === "time") {
            if (task.triggerValue) {
              const [targetH, targetM] = task.triggerValue.split(":").map(Number);
              const targetMinutes = targetH * 60 + targetM;
              if (nowMinutes >= targetMinutes) {
                canComplete = true;
              }
              info = `â° æ—¶é—´è§¦å‘ï¼š${task.triggerValue}ï¼ˆ${canComplete ? "âœ… å·²åˆ°" : "â³ æœªåˆ°"}ï¼‰`;
            } else {
              info = "â° æ—¶é—´è§¦å‘ï¼šæœªè®¾ç½®";
            }
          } else if (task.triggerType === "dependency") {
            const dep = tasks.find(t => t.id == task.triggerValue);
            if (dep && dep.completed) {
              canComplete = true;
              info = `ğŸ”— ä¾èµ–ä»»åŠ¡ï¼š${dep.title}ï¼ˆâœ… å·²å®Œæˆï¼‰`;
            } else {
              info = `ğŸ”— ä¾èµ–ä»»åŠ¡ï¼š${dep ? dep.title + "ï¼ˆæœªå®Œæˆï¼‰" : "æœªè®¾ç½®"}`;
            }
          }

          if (canComplete) {
            const btn = document.createElement("button");
            btn.textContent = "å®Œæˆ";
            btn.className = "bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600";
            btn.onclick = () => {
              task.completed = true;
              save();
              renderView();
              renderManage();
            };
            div.appendChild(btn);
          }

          if (info) {
            const infoSpan = document.createElement("span");
            infoSpan.className = "text-gray-500 text-sm ml-4";
            infoSpan.textContent = info;
            div.appendChild(infoSpan);
          }

          container.appendChild(div);
        } else {
          const div = document.createElement("div");
          div.className = "p-2 border rounded bg-gray-50 flex justify-between items-center";
          const label = document.createElement("span");
          label.innerHTML = `âœ… <strong>${task.title}</strong>`;
          div.appendChild(label);

          const delBtn = document.createElement("button");
          delBtn.textContent = "ğŸ—‘ åˆ é™¤";
          delBtn.className = "bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600";
          delBtn.onclick = () => {
            if (confirm("ç¡®è®¤åˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ")) {
              deleteTask(task.id);
            }
          };
          div.appendChild(delBtn);

          completedContainer.appendChild(div);
        }
      });
    }

    switchPage("manage");
  </script>
</body>
</html>
